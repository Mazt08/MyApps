<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>{{ product?.name || 'Product' }}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding product-detail-content">
  <ion-grid *ngIf="product as p">
    <ion-row>
      <ion-col size="12" size-md="6">
        <ion-card class="detail-card">
          <div
            *ngIf="images.length > 1; else singleImage"
            class="carousel-wrapper"
          >
            <button
              class="nav prev"
              (click)="scrollLeft()"
              aria-label="Previous image"
            >
              ‹
            </button>
            <div class="carousel" #carouselEl>
              <div class="slide" *ngFor="let img of images; let i = index">
                <img
                  [src]="img"
                  [alt]="p.name + ' image ' + (i+1)"
                  loading="lazy"
                  decoding="async"
                  (error)="onImgError($event)"
                />
              </div>
            </div>
            <button
              class="nav next"
              (click)="scrollRight()"
              aria-label="Next image"
            >
              ›
            </button>
            <div class="dots" *ngIf="images.length > 1">
              <span *ngFor="let img of images; let i = index"></span>
            </div>
          </div>
          <ng-template #singleImage>
            <img
              [src]="images[0] || p.image || defaultImage"
              [alt]="p.name"
              loading="lazy"
              decoding="async"
              (error)="onImgError($event)"
            />
          </ng-template>
          <ion-card-header>
            <ion-card-title>{{ p.name }}</ion-card-title>
            <ion-card-subtitle>
              {{ p.price === null ? 'Price Not Listed' : (p.price |
              currency:'USD') }}
            </ion-card-subtitle>
          </ion-card-header>
          <ion-card-content>
            <p class="desc" *ngIf="p.description; else noDesc">
              {{ p.description }}
            </p>
            <ng-template #noDesc>
              <p class="desc muted">No description available.</p>
            </ng-template>
            <div class="meta" *ngIf="p.category">
              <strong>Category:</strong> {{ p.category }}
            </div>
            <div class="meta" *ngIf="p.volume">
              <strong>Volume:</strong> {{ p.volume }}
            </div>
            <div class="meta" *ngIf="p.longevity">
              <strong>Longevity:</strong> {{ p.longevity }}
            </div>
            <div class="meta" *ngIf="p.notes">
              <strong>Notes:</strong> {{ p.notes }}
            </div>
            <ion-button
              class="back-btn"
              color="dark"
              expand="block"
              fill="outline"
              routerLink="/home"
            >
              <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
              Back to Catalog
            </ion-button>
            <ion-button color="tertiary" expand="block" (click)="addToCart()">
              Add to Cart
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>
</ion-content>
